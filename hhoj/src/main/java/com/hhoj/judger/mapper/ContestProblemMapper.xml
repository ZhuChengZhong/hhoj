<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hhoj.judger.mapper.ContestProblemMapper">

<cache ></cache>

<resultMap type="ContestProblem" id="contestProblemMap">
	<id column="cpId" property="cpId"/>
	<result column="title" property="title"/>
	<result column="contestId" property="contestId"/>
	<result column="accepted" property="accepted"/>
	<association property="problem" column="pid" select="com.hhoj.judger.mapper.ProblemMapper.findProblemById"></association>
	<association property="submit" column="submitId" select="com.hhoj.judger.mapper.SubmitMapper.findSubmitById"></association>
</resultMap>

<sql id="fields">
 cpId,pid,contestId,accepted,submited
</sql>
	
	<select id="findContestProblems" resultMap="contestProblemMap" parameterType="Integer">
	
		select <include refid="fields"></include> from t_contest_problem
		<where>
				<if test="contestId!=null">
					and contestId=#{contestId}
				</if>
		</where>
		
	</select>
    <select id="findContestProblemById" parameterType="Integer" resultMap="contestProblemMap"  >
        select <include refid="fields"></include> from t_contest_problem where cpId=#{cpId}  
    </select>
    
    
    
    <insert id="addContestProblem" parameterType="ContestProblem" useGeneratedKeys="true" keyProperty="cpId">
    	insert into t_contest_problem  ( <include refid="fields"></include> ) 
    	values (null,#{title},#{problem.pid},#{contestId},#{accepted},#{submit.sid})
    </insert>
    
    <update id="updateContestProblem" parameterType="ContestProblem">
    	update t_contest_problem  
    	<set>
	    	<if test="accepted!=null">
	    		accepted=#{accepted},
	    	</if>
    	</set>
    	
    	where cpId=#{cpId}
    </update>
   
   <delete id="removeContestProblem" parameterType="Integer">
   	delete from t_contest_problem where cpId =#{cpId}
   </delete>
</mapper>